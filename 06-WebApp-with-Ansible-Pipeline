pipeline {
    agent {
          label 'Agent'
       }
	   
	environment { 
       repo_url = "https://github.com/amitvashisttech/devops-ericsson-02-June-2025.git"
	   branch_name = "main" 
	   project_dir = "04-AppCode"
    }	


    stages {
        stage('Git CheckOut') {
            steps {
                git branch: "${branch_name}", url: "${repo_url}" 
            }
        }
       stage('Mvn CleanUp') {
            steps {
                sh "mvn clean -f ${project_dir}/pom.xml"
            }
        }
       stage('Mvn Compile') {
            steps {
                sh "mvn compile -f ${project_dir}/pom.xml"
            }
        }
       stage('Mvn Package') {
            steps {
                sh "mvn package -f ${project_dir}/pom.xml"
            }
        }
        
        
       stage('Archive Artifacts') {
            steps {
               archiveArtifacts artifacts: "${project_dir}/target/*.war", followSymlinks: false
            }
       }    
       
       stage('Stage-Deploy-Docker') {
            steps {
                sh "cd ${project_dir}; docker-compose up -d --build"
            }
       }
		
	   stage('Download Artifacts') {
            steps {
                sh "cp -rf ${project_dir}/target/*.war ${project_dir}/ansible-code/files/"
            }
        }
		
		stage('Getting Ready For Ansible') {
            steps {
                sh "echo \'<h1>JENKINS TASK BUILD ID: ${env.BUILD_DISPLAY_NAME}</h1>\' > 04-AppCode/ansible-code/files/jenkins.html"
            }
        }
		
		stage('Ansible Deployment') {
            steps {
                sh " cd ${project_dir}/ansible-code; ansible-playbook tomcat.yaml"
            }
        }
		
		
    }
}


